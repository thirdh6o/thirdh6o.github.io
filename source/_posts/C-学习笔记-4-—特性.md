---
title: C#学习笔记(4)—特性
date: 2026-01-16 14:57:55
tags:
- C#
categories:
- 学习笔记
description: 这篇文章介绍了C#中的特性，包括特性的定义、使用方法和注意事项。
---

## 什么是C#中的特性？
特性（Attribute）是用于在运行时传递程序中各种元素（比如类、方法、结构、枚举、组件等）的行为信息的声明性标签。  
使用通俗的话来说，C#的特性（Attribute）就是“贴在代码上的标签”，它是给编译器、框架、工具看的，而不是给程序逻辑直接用的。  

## 一个简单的特性示例

```csharp
[Obsolete("Use NewMethod instead")]
public void OldMethod()
{
}
```
上面发生了什么？  
这个方法还能用，但编译器会向我们发出警告：  
IDE 会提示“别再用这个了”  
我们没写任何 if / else语句，但行为发生了变化，这就是特性的力量。 

## 预定义特性与自定义特性
### 预定义特性
C# 提供了一些预定义的特性，比如 `Obsolete`、`Serializable`、`AttributeUsage` 等。  
#### Obsolete 特性
在上面的例子中，我们使用了 `Obsolete` 特性来标记 `OldMethod` 方法。  
这意味着 `OldMethod` 方法已经过时，不建议使用。  
当其他开发人员使用 `OldMethod` 方法时，编译器会向他们发出警告。  
#### Serializable 特性
`Serializable` 特性用于标记一个类可以被序列化，即可以将其状态转换为字节流以进行存储或传输。  
例如：
```csharp
[Serializable]
public class MyClass
{
    // 类的成员变量和方法
}
```
但是在“现代 Web API / JSON 场景”中，没那么重要了。  
现代 JSON 序列化器不要求 [Serializable]，更依赖：public 成员、属性、其他特性（如 [JsonIgnore]）
#### Conditional 特性
`Conditional` 特性用于在编译时根据条件来包含或排除方法的调用。  
例如：
```csharp
[Conditional("DEBUG")]
public void DebugMethod()
{
    // 调试用的代码
}
```
在上面的例子中，`DebugMethod` 方法只有在定义了 `DEBUG` 符号时才会被包含在编译中。  
这在调试时非常有用，因为我们可以在发布版本中排除调试用的代码。  
这与if (DEBUG) 完全不一样，if (DEBUG) 是在运行时根据条件来判断是否调用方法，而 `Conditional` 特性是在编译时根据条件来包含或排除方法的调用。  
此判断发生在编译期，零运行时成本   
> 我们可以这样看：如果条件不满足，编译器会“假装你从没写过这行调用代码”。  
### 自定义特性
除了预定义特性，我们还可以自定义特性。  
自定义特性的一般形式为：
```csharp
[AttributeUsage(AttributeTargets.All)]
public class MyAttribute : Attribute
{
    // 自定义属性的成员变量和方法
}
```
在上面的例子中，`MyAttribute` 是一个自定义特性，它可以应用于所有程序元素（如类、方法、属性等）。  
我们可以在自定义特性中添加任何我们需要的信息，比如权限、描述、参数等。  
